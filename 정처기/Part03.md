# Chapter01 SQL 응용
## 절차형 SQL 작성
### 1. 트리거
DB 시스템에서 데이터의 삽입, 갱신, 삭제 등의 이벤트가 발생할 때마다 관련 작업이 자동으로 수행되는 절차형 SQL
- 데이터 변경, 무결성 유지, 로그 메세지 출력 등의 목적으로 사용
- 트리거 구문에는 TCL을 사용할 수 없음
- 오류에 주의 : 트리거 실행중 오류가 발생하면 원인 데이터 작업에도 영향, 데이터 추가후 발생하는 트리거에서 오류가 발생할 경우 이후 작업이 진행되지 않거나 데이터가 추가되지 않음
```
CREATE [OR REPLACE] TRIGGER 트리거_이름
      {BEFORE | AFTER} {INSERT | UPDATE | DELETE} ON 테이블_이름
      [FOR EACH ROW]
WHEN (조건_제약)
    {[선언부]
BEGIN
     ...
END;} | 
CALL 함수_또는_프러시저_이름
```

### 2. 이벤트
특정 시간에 특정 쿼리, 프로시저, 함수 등을 실행
``` 
CREATE EVENT [IF NOT EXISTS]
ON SCHEDULE
[ON COMPLETION [NOT] PRESERVE]
[ENABLE | DISABLE]
[COMMENT '주석']
DO
[BEGIN]
  [실행할 SQL 문;]
[END] 
```

### 3. 사용자 정의 함수
- 프로시저와의 차이 : 문법이 비슷하나, 종료시 단일 값을 반환
```
create or replace function 1(2)
is
begin
...
	return[value];
end;
```

### 윈도우 함수
- 행과 행 간의 관계를 쉽게 정의하기 위해 만든 함수
```
SELECT 함수명(파라미터)
 OVER
([PARTITION BY 컬럼1, ..])
[ORDER BHY 컬럼a,...])
FROM 테이블
```
- 분류 : 집계함수, 순위함수, 행순서함수, 그룹 내 비율 함수 등등 
- DB를 사용한 온라인 분석 처리 용도로 사용하기 위해 추가된 기능으로 OLAP(online analytical processing) 함수라고도 함
    - `Roll-p` : 구체적인 데이터로 부터 구체적인 데이터로 접근하는 연산
    - `Drill-Down` : 요약된 형태의 데이터로부터 구체적인 데이터로 접근하는 연산
    - `Drill-Up` : 구체적인 데이터로부터 요약된 형태의 데이터로 접근하는 연산
    - `Slicing` : 온라인 분석처리를 위한 자료구조인 데이터 큐브의 한 조각을 볼 수 있게 해주는 연산
    - `Dicing` : 고정된 다차원 값에 대한 연산
    - `Pivoting` : 다차원 분석 테이블인 크로스 테이블에서 차원 변경을 위해 사용되는 연산

### 그룹함수
테이블의 전체 행을 하나 이상의 컬럼을 기준으로 컬럼 값에 따라 그룹화하여 그룹별로 결과를 출력하는 함수, GROUP BY ~ HAVING 사이에 쓴다!
- `ROLLUP` : 지정된 컬럼의 소계 및 총계를 구하기 위함
- `CUBE` : 결합 가능한 모든 값에 대해 다차원 집계를 생성, 내부적으로 대상 컬럼 순서를 변경하여 또 한번의 쿼리를 수행
- `GROUPING SETS` : 특정 항목에 대한 소계 출력

## 오류처리
#### 1. 액션
- `CONTINUE` : DECLARE CONTINUE HANDLER의 BEGIN ~ END 블럭을 실행하고, 이하의 SP 본문을 이어서 계속 실행합니다.
- `EXIT` : DECLARE EXIT HANDLER의 BEGIN ~ END 블럭을 실행하고, SP의 실행을 종료합니다.
- `UNDO` : 문법에는 나오지만 실제로 UNDO 기능을 지원하진 않습니다.
#### 2. 상태값
- 특정 에러 : 특정 ERROR CODE 발생, 특정 SQLSTATE 발생, SQLSTATE는 5자리 문자열 임
- `SQLWARNING` : 경고 발생, SQLSTATE는 '01'로 시작 함
- `NOT FOUND` : 커서가 마지막 레코드에 도달하여, 다음 레코드를 Fetch하지 못했을 때 / SQLSTATE는 '02'로 시작함
- `SQLEXCEPTION` : 에러가 발생, SQLSTATE가 '00', '01', '02'로 시작하지 않는 나머지 모두
#### 3. 명령문
핸들러가 호출될 떄 실행되는 명령 
```
DECLARE handler_action HANDLER
    FOR condition_value [, condition_value] ...
    statement
 
handler_action:
    CONTINUE
  | EXIT
  | UNDO
 
condition_value:
    mysql_error_code
  | SQLSTATE [VALUE] sqlstate_value
  | condition_name
  | SQLWARNING
  | NOT FOUND
  | SQLEXCEPTION

```

# Chapter 02 SQL 활용

## 트랜잭션
- 하나의 논리적 기능을 정상적으로 수행하기위한 작업 기본단위
- 인가받지 않은 사용자로부터 데이터를 보장하기 위해 가져야하는 특성
- 특징 : ACID(원자성 일관성 격리성 영속성)

### 1) 트랜잭션 연산(원자성 주요 기법)
- 연산 : 커밋, 롤백
### 2) 병행제어(일관성 주요기법)
병행제어 : 다수 사용자 환경에서 여러 트랜잭션을 수행할 때, 일관성 유지를 위해 상호작용을 제어하는 기법
- 목적: 디비 공유 최대화, 시스템활용도 최대화, 일관성유지, 응답시간 최소화
- 미보장시 문제점 : 갱신 손실(Lost update), 현황 파악오류(dirty read), 모순성, 연쇄 복귀
#### 종류 
- `로킹` : 같은 자원을 엑세스하는 다중 트랜잭션 환경에서 디비의 일관성와 무결성 유지를 위해 트랜잭션의 순차적 진행을 보장하는 직렬화 기법
- `낙관적 검증`
- `타임 스탬프 순서`
- `다중버전 동시성 제어(Multi Vesion Concurency Control)`

### 3) 고립화 수준(격리성 주요기법)
- 다른 트랜잭션이 현재 데이터에 대한 무결성을 해치지 않기 위해 잠금을 설정하는 정도
- 종류 : read uncommited, read commited, repeatable read, serializable read

### 4) 회복(영속성 주요기법)
- 종류 : 로그기반 회복법(지연갱신회복기법, 즉각 갱신 회복 기법), 체크포인트 회복기법, 그림자 페이징 회복기법

### 트랜잭션의 상태
- 종류 : Active, Particially Commiteed, commited, failed, aborted

## 뷰
- 사용자에게 접근이 허용된 자료만을 제한적으로 보여주기 위해 사용
- 가상 테이블
- 데이터의 논리적 독립성 제공 / 데이터 관리 간편 / 자동 보안
- 독립적 인덱스 못 가짐 / 뷰 정의 변경 못함
- 설계시 고려사항
  - 반복적 조인 설정 / 동일 조건절 사용 테이블 => 뷰로 생성
  - 사용할 데이터를 다양한 관점에서 제시
  
### 인덱스 스캔 방식
- 인덱스 범위 스캔, 인덱스 전체 스캔, 인덱스 단일 스캔, 인덱스 생략 스캔
  
### 물리적 조인
중첩 반복 조인, 정렬 합병 조인, 해시조인(비용기반 옵티마이저에서만 가능)

### 서브쿼리
유형
- 비연관 서브쿼리, 연관 서브쿼리
- 단일행, 다중행, 다중컬럼, 서브쿼리

# Chapter 03 논리 데이터베이스 설계
### 관계 대수 vs 관계해석
![image](https://user-images.githubusercontent.com/61506233/107137418-b67e5e80-694f-11eb-99d1-1da39976e02d.png)
  

### 시스템 카탈로그
시스템 그 자체에 관련이 있는 다양한 객체에 관한 정보를 포함하는 시스템 데이터베이스
- 시스템 카탈로그 내의 각 테이블은 사용자를 포함하여 DBMS에서 지원하는 모든 데이터 객체에 대한 정의나 명세에 관한 정보를 유지 관리하는 시스템 테이블이다.
- 데이터 정의어의 결과로 구성되는 기본 테이블, 뷰, 인덱스, 패키지, 접근 권한 등의 데이터베이스 구조 및 통계 정보를 저장한다.
- 카탈로그들이 생성되면 자료사전에 저장되기 떄문에 좁은 의미로는 카탈로그를 자료 사전이라고도 한다.
- 카탈로그에 저장된 정보를 메타 데이터라고 한다.
- 카탈로그 자체도 시스템 테이블로 구성되어 있어 일반 이용자도 SQL을 이용하여 내용을 검색해볼 수 있다. 갱신은 불가능
- DBMS가 스스로 생성하고 유지한다.
- 분산 시스템에서의 카탈로그 : 보통의 릴레이션, 인덱스, 사용자 등에 정보를 포함할 뿐 아니라 위치 투명성 및 중복 투명성을 제공하기 위해 필요한 모든 제어 정보를 가져야 한다.

#### 종류
- `SYSTABLES` : 기본 테이블 및 뷰 테이블의 정보를 저장하는 테이블
- `SYSCOLUMNS` : 모든 테이블에 대한 정보를 열(속성) 중심으로 저장하는 테이블
- `SYSVIEW` : 뷰에 대한 정보를 저장하는 테이블
- `SYSTABAUTH `: 테이블에 설정된 권한 사항들을 저장하는 테이블
- `SYSCOLAUTH` : 각 속성에 설정된 권한 사항들을 저장하는 테이블

### 정규화


# Chapter04 물리 데이터베이스 설계
- 데이터 단위 : 저장 레코드 (Stored Record)
- 응답 시간, 저장 공간의 효율화, 트랜잭션 처리도 등 전반적인 성능에 중대한 영향을 미친다. 
- 설계 시 고려 사항 : 레코드의 크기, 파일에 대한 트랜잭션의 갱신, 참조 성향, 인덱스의 구조 , 개념 스키마의 변경 여부 검토

## 스토리지
- 데이터를 보존하고 가능한 간편하게 엑세스 할 수 있도록 개발된 기술을 사용하여 정보를 보존하는 저장장치

### 1. DAS(Direct Attached Storage)
- 케이블로 직접 연결. 
- 속도가 빠르고, 운영이 쉽다. 
- 비용이 저렴하다. 
- 다른 서버의 접근이 불가하고, 파일 공유가 불가하다. 
- 유연하지 못하다. 
- 저장 데이터가 적고, 공유가 필요 없을 때 유리하다.
### 2. NAS(Netowork Attached Stroage )
- 네트워크를 통해 연결. 
- 다른 서버의 접근이 가능하고, 파일 공유가 가능하다. 
- 접속 증가 시, 성능이 저하될 수 있다.
### 3. SAN(Storage Area Network)
- DAS의 빠른 처리와, NAS의 파일 공유 장점을 합친 방식. 
- 파이버 채널(FC : Fiber Channel) 스위치를 이용하여 네트워크를 구성한다. 
- 비용이 많이 든다.

## 분산 데이터베이스
네트워크상에서 여러 컴퓨터에 물리적으로 분산되어있지만 , 하나의 데이터베이스처럼 인식하도록 논리적으로 통합된 데이터베이스

- 분산 처리기 : 자체적인 처리 능력을 가진다. 
- 분산 데이터베이스 : 데이터베이스 그 자체
- 통신 네트워크 : 통신망으로 연결하여, 하나의 논리적 시스템으로 한다.

#### 투명성
- 위치 투명성 : 실제 위치를 알 필요 없이, 논리적 명칭만으로 접근 가능
- 중복 투명성 : 동일 데이터가 여러 곳에 있어도, 사용자는 하나의 데이터만 존재하는 것처럼 사용
- 병행 투명성 : 다수의 트랜잭션이 동시에 실현되어도, 결과는 영향을 받지 않는다.
- 장애 투명성 : 장애에도 불구하고, 트랜잭션을 정확하게 처리한다.
- 분할 투명성

#### 구성
- 전역 스키마
- 분할 스키마
- 할당 스키마
- 지역 스키마 - 지역 DBMS

분산 데이터베이스의 설계 방법 
- 테이블 위치 분산, 분할 (Fragmentation), 할당 (Allocation)

### 데이터베이스 이중화
여러 db에 대해 로컬 db의 변경된 내용을 원격db에 복제하고 관리
- 목적: 무정지 서비스 가능케, 사용자는 하나의 db에 대해서만 작업수행, 이중화시스템에 연결되어있는 다른 db에도 동일하게 적용, 여러개 동시관리
- 형태 : 액티브-액티브(여러 노드 동시가동) 액티브-스탠바이(하나의 노드만 가동하고 나머지 노드들은 대기)

## 데이터베이스 암호화
- 응용 프로그램 자체 암호호, db 서버 암호회, dbms 자체 암호화, dbms 암호화 기능 호출, 운체 암호화
- 적용방식
   - 칼럼암호화 : API, 플러그인, 하이브리드 방식
   - 블록 암호화 : TDE(DB 내부에서 저장시 암호화 이후 파일에 저장된 내용을 메모리 영역으로 가져올 때 DBMS에 의해 자동으로 복호화함), 파일암호화방식

## 접근통제
- 접근통제는 데이터가 저장된 객체와 이를 사용하려는 주체 사이의 정보흐름을 제한하는 것이다.
- 비인가된 사용자의 접근 감시, 접근 요구자의 사용자 식별, 접근 요구의 정당성 확인 및 기록, 보안 정책에 근거한 접근의 승인 및 거부
- 접근통제의 3요소는 접근통제 정책, 접근통제 매커니즘, 접근통제 보안모델이다.

### 종류
- `임의 접근통제(DAC)` : 사용자의 신원에 따라 접근 권한 부여, 통제 권한이 주체에 있어 주체가 접근통제 권한을 제어, 사용되는 SQL 명령어로는 GRANT, REVOKE 가 있다.
- `강제 접근통제(MAC)` : 강제 접근통제는 주체와 객체의 등급을 비교하여 접근 권한을 부여하는 방식, 제3자가 접근통제 권한을 지정


### 접근통제 정책
- 어떤 주체가 언제, 어디서, 어떤 객체에게, 어떤 행위에 대한 허용 여부를 정의하는 것으로 신분 기반 정책, 규칙 기반 정책, 역할 기반 정책이 있다.
- `신분 기반 정책`(DAC) : 주체나 그룹의 신분에 근거하여 객체의 접근을 제한하는 방법으로 IBP, GBP가 있다.
- `규칙 기반 정책`(GBP) : 주체가 갖는 권한에 근거하여 객체의 접근을 제한하는 방법으로 MLP, CBP가 있다.
- `역할 기반 정책`(RBAC) : GBP의 변형된 정책으로, 주체의 신분이 아니라 주체가 맡은 역할에 근거하여 객체의 접근을 제한하는 방법

### 접근통제 매커니즘
- 접근통제 매커니즘은 정의된 접근통제 정책을 구현하는 기술적인 방법으로, 접근통제 목록, 능력 리스트, 보안 등급, 패스워드, 암호화 등이 있다.
- 'ACL' : 주체가 디렉토리나 파일과 같은 특정 시스템 객체에 접근할 수 있는 허가 받은 접근 종류들이 기록된 목록 / 구분되어야할 주체가 적은경우 적합
- 'CLI' : 주체에게 허가된 자원 및 권한의 목록 / 객체가 적은 경우 적합

### 접근통제 보안 모델
- 접근통제 보안 모델은 보안 정책을 구현하기 위한 정형화된 모델로, 기밀성 모델, 무결성 모델, 접근통제 모델이 있다.
- `기밀성 모델` : 군사적인 목적으로 최초 개발, 기밀성 보장이 최우선
- `무결성 모델` : 기밀성 모델에서 발생하는 불법적인 정보 변경을 방지하기 위해 무결성을 기반으로 개발된 모델, 일관성 유지가 중요
- `접근제어 행렬` : 접근통제 메커니즘을 보안 모델로 발전시킨 것으로, 대표적으로 접근통제 행렬이 있다.

### 접근통제 조건
- 접근통제 조건은 접근통제 메커니즘의 취약점을 보안하기 위해 접근통제 정책에 부가하여 적용할 수 있는 조건이다.
- 값 종속 통제, 다중 사용자 통제, 컨텍스트 기반 통제

### 감사 추적
- 데이터베이스에 접근하여 수행한 모든 활동을 기록하는 기능

## 데이터베이스 백업 
전산 장비의 장애에 대비하여 데이터베이스에 저장된 데이터를 보호하고 복구하기 위한 작업으로, 치명적 데이터 손실을 막기 위해서는 데이터베이스를 정기적으로 백업해야 한다.

### 데이터베이스 장애 유형
- 사용자 실수, 미디어 장애, 구문 장애, 사용자 프로세스 장애, 인스턴스 장애

### 로그 파일
- 로그 파일은 데이터베이스의 처리 내용이나 이용 상황 등 상태 변화를 시간의 흐름에 따라 모두 기록한 파일로, 데이터베이스의 복구를 위해 필요한 가장 기본적인 자료이다.
- 로그 파일을 기반으로 데이터베이스를 과거 상태로 복귀(UNDO)시키거나 현재 상태로 재생(REDO)시켜 데이터베이스 상태를 일관성 있게 유지할 수 있다.
- 로그 파일은 트랜잭션 시작 시점, Rollback 시점, 데이터 입력, 수정 삭제 시점등에서 기록된다.
- 로그 파일 내용 : 트랜잭션이 작업한 모든 내용, 트랜잭션 식별, 트랜잭션 레코드, 데이터 식별자, 갱신 이전 값, 갱신 이후 값 등

### 데이터베이스 복구 알고리즘
- 동기적/비동기적 갱신에 따라 NO-UNDO/REDO, UNDO/NO-REDO, UNDO/REDO, NO-UNDO/NO-REDO 방법으로 분류한다.

### 백업 종류
- 물리 백업 : 데이터베이스 파일을 백업하는 방법으로, 백업 속도가 빠르고 작업이 단순하지만 문제 발생 시 원인 파악 및 해결이 어렵다.
- 논리 백업 : DB내의 논리적 객체들을 백업하는 방법으로, 복원 시 데이터 손상을 막고 문제 발생 시 원인 파악 및 해결이 수월하지만 백업/복원 시 시간이 많이 소요된다. 완전 복구가 아닌 백업 시점까지만 복구 가능
- 전체백업, 차등백업, 증분백업, 트랜잭션 로그백업

## 데이터 지역화
필요한 위치에 가까이 데이터를 배치하는 것을 의미
- 종류 : 시간적, 공간적, 순차적 지역화
- 관리기법 : 기억장치 계층구조, 캐시접근시간 단축, 작업세트

### 파티션 설계
- 대용량 테이블/인덱스를 작은 논리적 단위인 파티션으로 분할
- 성능 저하 방지 / 데이터 관리 용이
- 물리적으로 별도 공간에 저장
- 데이터 처리는 테이블 단위  / 데이터 저장은 파티션별로 수행
- 단점 : 세심한 관리 필요 / 조인 비용 증가 / 용량 작은 테이블에는 성능 저하
- 종류 : 범위 / 해시 / 조합 분할

고려사항
- 테이블 접근 유형에 따라 파티셔닝
- 이력성 데이터는 파티션 생성/소멸주기 일치

인덱스 파티션
- Local : 테이블 파티션과 인덱스 파티션이 1대1
- Global : 테이블 파티션과 인덱스 파티션이 독립적

### 클러스터 
- 데이터 저장 시 데이터 액세스 효율을 향상시키기 위해 동일 성격의 데이터를 동일 데이터 블록에 저장

 특징
- 조회 속도 향상 / 입력-수정-삭제 속도 하락
- 데이터 분포도 넓을수록 유리
- 데이터 분포도 넓은 테이블 클러스터링 시 저장 공간 절약
- 대용량 처리 트랜잭션은 클러스터링 안하는 게 좋다
- 처리 범위가 넓으면 단일 테이블 클러스터링 / 좁으면 다중 테이블 클러스터링
- 파티셔닝 된 테이블은 클러스터링 불가


## SQL 성능 튜닝
- 최소 자원을 이용해 최적 성능을 제공하도록 하는 개선 활동
- 기법 : 옵티마이저 조정, 힌트사용, 부분범위처리사용, 인덱스활용

# Chapter 05 데이터 전환
- `ETL(Extraction, Transformation, Loading)` : 데이터를 추출하여 변환작업을 거쳐 적재하는 프로세스이다.
- 파일처리 기술 유형 : 순차파일, 색인 순차 파일, 직접 파일 


